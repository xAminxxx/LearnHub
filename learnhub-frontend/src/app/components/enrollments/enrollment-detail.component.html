<div class="container-fluid px-0" *ngIf="!loading() && enrollment() as e">
  <div class="d-flex align-items-center justify-content-between mb-4">
    <div>
      <h2 class="fw-bold mb-1">Enrollment File #{{ e.id }}</h2>
      <p class="text-secondary mb-0">Detailed student-course association and performance metrics.</p>
    </div>
    <div class="d-flex gap-2">
      <a routerLink="/enrollments" class="btn btn-outline-secondary btn-sm rounded-pill px-3">
        <i class="bi bi-arrow-left me-1"></i> Registry
      </a>
      <a [routerLink]="['/enrollments/edit', e.id]" class="btn btn-primary btn-sm rounded-pill px-3 shadow-sm">
        <i class="bi bi-pencil-square me-1"></i> Edit Record
      </a>
    </div>
  </div>

  <div class="card border-0 shadow-sm mb-4">
    <div class="card-body p-4 p-md-5">
      <div class="row g-5">
        <div class="col-md-6" *ngIf="e.student">
          <h5 class="text-primary fw-bold mb-4 border-bottom pb-2">
            <i class="bi bi-person-badge me-2"></i>Student Details
          </h5>
          <div class="d-flex align-items-center mb-4">
            <img [src]="'https://ui-avatars.com/api/?name=' + e.student.firstName + '+' + e.student.lastName + '&background=random'" 
                 class="rounded-circle me-3" width="60" height="60">
            <div>
              <h4 class="fw-bold mb-1">{{ e.student.firstName }} {{ e.student.lastName }}</h4>
              <span class="text-secondary">{{ e.student.email }}</span>
            </div>
          </div>
          <div class="small bg-light p-3 rounded-3 border">
            <div class="d-flex justify-content-between mb-2">
              <span class="text-secondary">Student ID:</span>
              <span class="fw-bold">#{{ e.student.id }}</span>
            </div>
            <div class="d-flex justify-content-between">
              <span class="text-secondary">Phone:</span>
              <span class="fw-bold">{{ e.student.phone }}</span>
            </div>
          </div>
        </div>

        <div class="col-md-6" *ngIf="e.course">
          <h5 class="text-primary fw-bold mb-4 border-bottom pb-2">
            <i class="bi bi-journal-text me-2"></i>Course Details
          </h5>
          <div class="mb-4">
            <div class="badge bg-indigo bg-opacity-10 text-indigo mb-2" style="background-color: rgba(79, 70, 229, 0.1); color: #4f46e5;">{{ e.course.code }}</div>
            <h4 class="fw-bold mb-1">{{ e.course.title }}</h4>
            <span class="text-secondary" *ngIf="e.course.specialization">{{ e.course.specialization.name }}</span>
          </div>
          <div class="small bg-light p-3 rounded-3 border">
            <div class="d-flex justify-content-between mb-2" *ngIf="e.course.trainer">
              <span class="text-secondary">Instructor:</span>
              <span class="fw-bold">{{ e.course.trainer.firstName }} {{ e.course.trainer.lastName }}</span>
            </div>
            <div class="d-flex justify-content-between">
              <span class="text-secondary">Credits:</span>
              <span class="fw-bold">{{ e.course.credit }} Units</span>
            </div>
          </div>
        </div>

        <div class="col-12 mt-4">
          <h5 class="text-primary fw-bold mb-4 border-bottom pb-2">
            <i class="bi bi-graph-up-arrow me-2"></i>Performance & Status
          </h5>
          <div class="row g-4 align-items-center text-center">
            <div class="col-md-4">
              <div class="p-4 border rounded-3 bg-white shadow-sm">
                <div class="text-secondary small mb-2 text-uppercase fw-bold">Current Status</div>
                <span class="badge rounded-pill px-4 py-2" [ngClass]="getStatusBadgeClass(e.status)">
                  {{ e.status }}
                </span>
              </div>
            </div>
            <div class="col-md-4">
              <div class="p-4 border rounded-3 bg-white shadow-sm">
                <div class="text-secondary small mb-2 text-uppercase fw-bold">Engagement Score</div>
                <div *ngIf="e.score !== null && e.score !== undefined">
                  <span class="display-6 fw-bold text-dark">{{ e.score }}</span>
                  <span class="text-secondary">/ 20</span>
                </div>
                <div *ngIf="e.score === null || e.score === undefined" class="text-muted italic small py-2">
                  Not Yet Evaluated
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="p-4 border rounded-3 bg-white shadow-sm">
                <div class="text-secondary small mb-2 text-uppercase fw-bold">Admission Date</div>
                <div class="fw-bold fs-5">{{ e.enrollmentDate | date:'MMM dd, yyyy' }}</div>
                <div class="small text-secondary">{{ e.enrollmentDate | date:'HH:mm' }}</div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-12" *ngIf="e.notes">
          <h6 class="text-secondary fw-bold mb-2">Administrative Notes</h6>
          <div class="p-3 bg-light rounded-3 border-start border-4 border-indigo italic" style="border-left-color: #4f46e5 !important;">
            {{ e.notes || 'No notes recorded for this enrollment.' }}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div *ngIf="loading()" class="text-center py-5">
  <div class="spinner-border text-primary" role="status">
    <span class="visually-hidden">Loading...</span>
  </div>
</div>

<div *ngIf="errorMessage()" class="alert alert-danger mx-4">
  {{ errorMessage() }}
</div>
